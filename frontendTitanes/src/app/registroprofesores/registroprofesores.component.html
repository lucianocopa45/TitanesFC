<div class="form-container">
  <h2>Registro de Profesores</h2>

  <!-- Paso 1 -->
  <form [formGroup]="formProfesor" (ngSubmit)="siguientePaso()" *ngIf="step === 1" novalidate>
    <div class="form-group">
      <label for="nombre">Nombre:</label>
      <input id="nombre" formControlName="nombre" type="text" />
      <div class="error" *ngIf="formProfesor.get('nombre')?.touched && formProfesor.get('nombre')?.invalid">
        El nombre es obligatorio.
      </div>
    </div>

    <div class="form-group">
      <label for="apellido">Apellido:</label>
      <input id="apellido" formControlName="apellido" type="text" />
      <div class="error" *ngIf="formProfesor.get('apellido')?.touched && formProfesor.get('apellido')?.invalid">
        El apellido es obligatorio.
      </div>
    </div>

    <div class="form-group">
      <label for="dni">DNI:</label>
      <input id="dni" formControlName="dni" type="text" />
      <div class="error" *ngIf="formProfesor.get('dni')?.touched && formProfesor.get('dni')?.invalid">
        DNI inválido (7 a 10 números).
      </div>
    </div>

    <div class="form-group">
      <label for="fecha_nacimiento">Fecha de Nacimiento:</label>
      <input id="fecha_nacimiento" formControlName="fecha_nacimiento" type="date" />
      <div class="error" *ngIf="formProfesor.get('fecha_nacimiento')?.touched && formProfesor.get('fecha_nacimiento')?.invalid">
        La fecha de nacimiento es obligatoria.
      </div>
    </div>

    <div class="form-group">
      <label for="direccion">Dirección:</label>
      <input id="direccion" formControlName="direccion" type="text" />
      <div class="error" *ngIf="formProfesor.get('direccion')?.touched && formProfesor.get('direccion')?.invalid">
        La dirección es obligatoria.
      </div>
    </div>

    <div class="form-group">
      <label for="telefono">Teléfono:</label>
      <input id="telefono" formControlName="telefono" type="text" />
      <div class="error" *ngIf="formProfesor.get('telefono')?.touched && formProfesor.get('telefono')?.invalid">
        El teléfono es obligatorio.
      </div>
    </div>

    <div class="form-group especialidades">
      <label>Especialidades:</label>
      <div *ngFor="let esp of especialidadesDisponibles" class="checkbox-group">
        <input
          type="checkbox"
          [checked]="tieneEspecialidad(esp)"
          (change)="actualizarEspecialidad(esp, $event)"
          [id]="'esp-' + esp"
        />
        <label [for]="'esp-' + esp">{{ esp }}</label>
      </div>
      <div class="error" *ngIf="formProfesor.get('especialidad')?.touched && formProfesor.get('especialidad')?.invalid">
        Debe seleccionar al menos una especialidad.
      </div>
    </div>

    <div class="form-group actividades">
      <label>Actividades:</label>
      <div *ngFor="let act of actividades" class="checkbox-group">
        <input
          type="checkbox"
          [checked]="tieneActividad(act.id_actividad)"
          (change)="actualizarActividad(act.id_actividad, $event)"
          [id]="'act-' + act.id_actividad"
        />
        <label [for]="'act-' + act.id_actividad">{{ act.nombre_actividad }}</label>
      </div>
      <div class="error" *ngIf="formProfesor.get('actividad')?.touched && formProfesor.get('actividad')?.invalid">
        Debe seleccionar al menos una actividad.
      </div>
    </div>

    <div class="botones">
      <button type="submit" class="btn-primary">Siguiente</button>
      <button type="button" (click)="limpiarFormulario()" class="btn-secondary">Limpiar</button>
    </div>
  </form>

  <!-- Paso 2 -->
  <form [formGroup]="formProfesor" (ngSubmit)="enviar()" *ngIf="step === 2" novalidate>
    <div class="form-group">
      <label for="email">Email:</label>
      <input id="email" formControlName="email" type="email" />
      <div class="error" *ngIf="formProfesor.get('email')?.touched && formProfesor.get('email')?.invalid">
        Email inválido.
      </div>
    </div>

    <div class="form-group">
      <label for="password">Contraseña:</label>
      <input id="password" formControlName="password" type="password" />
      <div class="error" *ngIf="formProfesor.get('password')?.touched && formProfesor.get('password')?.invalid">
        La contraseña es obligatoria.
      </div>
    </div>

    <div class="form-group">
      <label for="confirmPassword">Confirmar Contraseña:</label>
      <input id="confirmPassword" formControlName="confirmPassword" type="password" />
      <div
        class="error"
        *ngIf="
          formProfesor.hasError('noCoinciden') &&
          formProfesor.get('confirmPassword')?.touched
        "
      >
        Las contraseñas no coinciden.
      </div>
    </div>

    <div class="botones">
      <button type="button" (click)="pasoAnterior()" class="btn-secondary">Volver</button>
      <button type="submit" class="btn-primary">Enviar</button>
    </div>
  </form>

  <!-- Tabla de Profesores -->
  <section class="tabla-profesores" *ngIf="profesores.length > 0">
    <h3>Profesores registrados</h3>
    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>DNI</th>
          <th>Especialidad</th>
          <th>Actividad</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let prof of profesores">
          <td>{{ prof.nombre }}</td>
          <td>{{ prof.apellido }}</td>
          <td>{{ prof.dni }}</td>
          <td>{{ prof.especialidad }}</td>
          <td>{{ prof.actividad }}</td>
          <td>
            <button (click)="modificarProfesor(prof)" class="btn-edit">Modificar</button>
            <button (click)="eliminarProfesor(prof.id_profesor)" class="btn-delete">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </section>
</div>

<!-- Toast de mensajes -->
<div
  class="toast-container"
  *ngIf="mostrarToast"
  [ngClass]="{ 'toast-error': toastError, 'toast-success': !toastError }"
>
  {{ mensajeToast }}
</div>
